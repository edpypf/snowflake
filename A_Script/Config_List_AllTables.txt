select 'Y' as ACTIVE, SOURCE_TABLE_NAME as jobName, SOURCE_TABLE_NAME as sourceTable, '' as SourceFile, SOURCE_TABLE_NAME as TargetTable, '' as TargetFile, 'TRUE' as IsTable, '*' as srcCol, '*' as tgtCol,
'EXPIRATION_DATE|LAST_MODIFICATION_DATE|LAST_MODIFICATION_FILE_KEY' as SkipColumns, concat('WHERE ',column_name, ' BETWEEN DATE\'2021-01-01\' AND DATE\'2021-01-01\'') AS SourceFilter,
concat(' WHERE TO_DATE(',column_name,') BETWEEN \'2021-01-01\' AND \'2021-01-01\'') AS TargetFilter, '' as FileType, '' as FileFieldDelimiter, LOAD_COUNT
From (SELECT DM.JOB_NAME,DM.SOURCE_TABLE_NAME,da.ID,CAST(da.START_TIME AS DATE) AS Load_Start_Date,da.START_TIME,da.END_TIME,
CASE WHEN da.STATUS='SUCCESS' THEN DATEDIFF(second,da.START_TIME,da.END_TIME) ELSE 0 END AS Load_Time,da.LOAD_COUNT,TSize.Size_GB,da.STATUS
FROM "TERADATA_MIG_UAT"."JOB_MANAGEMENT"."DATA_MIGRATION_INVENTORY" dm
INNER JOIN
(SELECT ID,JOB_NAME,SOURCE_TABLE_NAME,START_TIME,END_TIME,LOAD_COUNT,STATUS,RANK() OVER (PARTITION BY SOURCE_TABLE_NAME ORDER BY START_TIME  DESC) AS Rank_Num
FROM "TERADATA_MIG_UAT"."JOB_MANAGEMENT"."DATA_AUDIT_TABLE" ORDER BY SOURCE_TABLE_NAME,START_TIME
) da
ON (DM.JOB_NAME = DM.JOB_NAME AND DM.SOURCE_TABLE_NAME = da.SOURCE_TABLE_NAME)
LEFT JOIN (
SELECT CONCAT(table_schema,'.',table_name) Table_Name,SUM(bytes)/(1024*1024*1024) AS Size_GB
FROM "TERADATA_MIG_UAT"."INFORMATION_SCHEMA"."TABLES"
GROUP BY CONCAT(table_schema,'.',table_name)
) TSize
ON (DM.SOURCE_TABLE_NAME=TSize.Table_Name)
WHERE da.Rank_Num=1
and DM.SOURCE_TABLE_NAME not like 'PCGO_LOG%' and DM.SOURCE_TABLE_NAME not like 'PCGO_STG.LDCUR%' and DM.SOURCE_TABLE_NAME not like 'PCGO_STG.REJ%' and DM.SOURCE_TABLE_NAME not like '%.VT_%'
and DM.SOURCE_TABLE_NAME not like 'MRSAC.%' and DM.SOURCE_TABLE_NAME not like 'MIPAC.%'
ORDER BY da.START_TIME DESC) FU
left outer join
(select CONCAT(table_schema,'.',table_name) MTable_Name, column_name
from "TERADATA_MIG_UAT"."INFORMATION_SCHEMA"."COLUMNS" COL
where column_name='CREATION_DATE' or column_name='POSTDATE') as DT
on FU.SOURCE_TABLE_NAME=Mtable_name